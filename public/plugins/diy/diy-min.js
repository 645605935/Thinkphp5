$(function(){HYD.DIY=HYD.DIY?HYD.DIY:{},HYD.DIY.Unit=HYD.DIY.Unit?HYD.DIY.Unit:{},HYD.DIY.PModules=HYD.DIY.PModules?HYD.DIY.PModules:[],HYD.DIY.LModules=HYD.DIY.LModules?HYD.DIY.LModules:[];var a=$("#diy-contain"),b=$("#diy-ctrl");HYD.DIY.constant={diyoffset:$(".diy").offset()},HYD.DIY.getTimestamp=function(){var a=new Date;return""+a.getFullYear()+parseInt(a.getMonth()+1)+a.getDate()+a.getHours()+a.getMinutes()+a.getSeconds()+a.getMilliseconds()},HYD.DIY.add=function(b,c){var d=_.template($("#tpl_diy_con_type"+b.type).html(),b),e=_.template($("#tpl_diy_conitem").html(),{html:d}),f=$(e);b.dom_conitem=f;var g=f.find(".diy-conitem-action"),h=(g.find(".j-edit"),g.find(".j-del"));g.click(function(){$(".diy-conitem-action").removeClass("selected"),$(this).addClass("selected"),HYD.DIY.edit(b)});var i="";return b.draggable?(h.click(function(){return HYD.DIY.del(b),!1}),i=".drag"):(h.remove(),i=".nodrag"),a.find(i).append(f),c=c?c:!1,c&&g.click(),b.draggable?HYD.DIY.LModules.push(b):HYD.DIY.PModules.push(b),!1},HYD.DIY.edit=function(a){b.find(".diy-ctrl-item[data-origin='item']").remove();var c=$("#tpl_diy_ctrl").html(),d=_.template($("#tpl_diy_ctrl_type"+a.type).html(),a),e=_.template(c,{html:d}),f=$(e);return b.append(f),HYD.DIY.repositionCtrl(a.dom_conitem,f),HYD.DIY.bindEvents(f,a),f.show().siblings(".diy-ctrl-item").hide(),!1},HYD.DIY.repositionCtrl=function(a,b){var c=a.offset().top,d=c-HYD.DIY.constant.diyoffset.top;b.css("marginTop",d),$("html,body").animate({scrollTop:d},300)},HYD.DIY.del=function(a){return a?($.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"删除后将不可恢复，是否继续？"}),btnOK:{onBtnClick:function(c){$.jBox.close(c);for(var d=HYD.DIY.LModules,e=HYD.DIY.LModules.length,f=0;e>f;f++)if(d[f].id==a.id){d.splice(f,1);break}a.dom_conitem.remove(),b.find(".diy-ctrl-item[data-origin='item']").remove()}}}),!1):void 0},HYD.DIY.bindEvents=function(a,b){6!=b.type&&10!=b.type&&HYD.DIY.Unit["event_type"+b.type](a,b)},HYD.DIY.reCalcPModulesSort=function(){_.each(HYD.DIY.LModules,function(a,b){a.sort=a.dom_conitem.index()})},HYD.DIY.Unit.getData=function(){HYD.DIY.reCalcPModulesSort();var a={page:{},PModules:{},LModules:{}};a.page.title=$(".j-pagetitle-ipt").val(),a.page.subtitle=$(".j-pagesubtitle-ipt").val(),a.page.view_pic=$(".j-view_pic-ipt").prop("src"),a.page.praise_num=$(".j-pagepraisenum").val(),a.PModules=HYD.DIY.PModules,a.page.goto_time=$(".j-gototime-ipt").val();for(var b=[],c=0;c<HYD.DIY.LModules.length;c++){var d=HYD.DIY.LModules[c];""!=d&&(b[d.sort]=d)}a.LModules=b;var d=$.extend(!0,{},a);return _.each(d.LModules,function(a){a.dom_conitem=null,a.dom_ctrl=null,a.ue=null}),_.each(d.PModules,function(a){a.dom_conitem=null,a.dom_ctrl=null,a.ue=null}),d},HYD.DIY.Unit.html_encode=function(a){var b="";return 0==a.length?"":(b=a.replace(/&/g,"&amp;"),b=b.replace(/</g,"&lt;"),b=b.replace(/>/g,"&gt;"),b=b.replace(/ /g,"&nbsp;"),b=b.replace(/\'/g,"&#39;"),b=b.replace(/\"/g,"&quot;"))},HYD.DIY.Unit.html_decode=function(a){var b="";return 0==a.length?"":(b=a.replace(/&amp;/g,"&"),b=b.replace(/&lt;/g,"<"),b=b.replace(/&gt;/g,">"),b=b.replace(/&nbsp;/g," "),b=b.replace(/&#39;/g,"'"),b=b.replace(/&quot;/g,'"'))}}),$(function(){HYD.DIY.Unit.event_type1=function(a,b){var c=b.dom_conitem;b.ue&&b.ue.destroy(),b.ue=UE.getEditor("editor"+b.id),b.ue.ready(function(){b.ue.setContent(HYD.DIY.Unit.html_decode(b.content.fulltext)),b.ue.focus(!0);var a=function(){var a=b.ue.getContent();""==a&&(a="<p>『富文本编辑器』</p>"),c.find(".fulltext").html(a),b.content.fulltext=HYD.DIY.Unit.html_encode(a)};b.ue.addListener("selectionchange",a),b.ue.addListener("contentChange",a)})},HYD.DIY.Unit.event_type2=function(a,b){var c=b.dom_conitem,d=a;b.dom_ctrl=a,d.find("input[name='title']").change(function(){var a=$(this).val();c.find(".j-title").text($(this).val()),b.content.title=a}),d.find("input[name='subtitle']").change(function(){var a=$(this).val();c.find(".j-subtitle").text($(this).val()),b.content.subtitle=a}),d.find("input[name='direction']").change(function(){var a=$(this).val();c.find(".members_special").removeClass("left center right").addClass(a),b.content.direction=a})},HYD.DIY.Unit.event_type3=function(a,b){var c=b.dom_conitem,d=a;b.dom_ctrl=a;var e=function(){HYD.popbox.ModulePicker(function(a){c.find(".type3_custModule").text(a.title),d.find(".type3_custModule_ctrl").text(a.title),b.content=a})},f=function(){HYD.popbox.ModulePicker(function(a){c.find(".type3_custModule").text(a.title);var f=_.template($("#tpl_diy_ctrl_type3_modify").html(),{content:a}),g=$(f);g.filter(".j-btn-modify").click(e),d.find(".form-controls").empty().append(g),b.content=a})};d.find(".j-btn-add").click(f),d.find(".j-btn-modify").click(e)},HYD.DIY.Unit.event_type4=function(a,b){var c=b.dom_conitem,d=a,e=$("#tpl_diy_con_type4").html(),f=$("#tpl_diy_ctrl_type4").html();b.dom_ctrl=a;var g=function(a){var g=$(_.template(e,b));c.find(".members_con").remove().end().append(g);var h=$(_.template(f,b));d.empty().append(h),HYD.DIY.Unit.event_type4(d,b),a&&a()},h=function(){$(".mingoods,.biggoods").each(function(a,b){var c=$(this),d=c.find("img").width();c.find("img").height(d)})};d.find("input[name='layout']").change(function(){var a=$(this).val();b.content.layout=a,g(h)}),d.find("input[name='showName']").change(function(){var a=$(this).val();b.content.showName=a,g()}),d.find("input[name='showIco']").change(function(){var a=$(this).is(":checked");b.content.showIco=a,g()}),d.find("input[name='showPrice']").change(function(){var a=$(this).is(":checked");b.content.showPrice=a,g()}),d.find(".j-delgoods").click(function(){var a=$(this).parents("li").index();return b.content.goodslist.splice(a,1),g(h),!1}),d.find(".j-addgoods").click(function(){return HYD.popbox.GoodsAndGroupPicker("goodsMulti",function(a){_.each(a,function(a){b.content.goodslist.push(a)}),g(h)}),!1})},HYD.DIY.Unit.event_type5=function(a,b){var c=b.dom_conitem,d=a,e=$("#tpl_diy_con_type5").html(),f=$("#tpl_diy_ctrl_type5").html();b.dom_ctrl=a;var g=function(){var a=$(_.template(e,b));c.find(".members_con").remove().end().append(a);var g=$(_.template(f,b));d.empty().append(g),HYD.DIY.Unit.event_type5(d,b)};d.find("input[name='layout']").change(function(){var a=$(this).val();b.content.layout=a,g()}),d.find("input[name='showName']").change(function(){var a=$(this).is(":checked");b.content.showName=a,g()}),d.find("input[name='showIco']").change(function(){var a=$(this).is(":checked");b.content.showIco=a,g()}),d.find("input[name='showPrice']").change(function(){var a=$(this).is(":checked");b.content.showPrice=a,g()}),d.find(".j-btn-add,.j-btn-modify").click(function(){HYD.popbox.GoodsAndGroupPicker("group",function(a){b.content.group=a,g()})}),d.find('input[name="goodsize"]').change(function(a){var c=$(this),d=c.val();b.content.goodsize=d,g()})},HYD.DIY.Unit.event_type7=function(a,b){var c=b.dom_conitem,d=a,e=$("#tpl_diy_con_type7").html(),f=$("#tpl_diy_ctrl_type7").html();b.dom_ctrl=a;var g=function(){var a=$(_.template(e,b));c.find(".members_con").remove().end().append(a);var g=$(_.template(f,b));d.empty().append(g),HYD.DIY.Unit.event_type7(d,b)};d.find("input[name='title']").change(function(){var a=$(this).parents("li.ctrl-item-list-li").index();b.content.dataset[a].showtitle=$(this).val(),g()}),d.find(".droplist li").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();HYD.popbox.dplPickerColletion({linkType:$(this).data("val"),callback:function(c,d){b.content.dataset[a].title=c.title,b.content.dataset[a].showtitle=c.title,b.content.dataset[a].link=c.link,b.content.dataset[a].linkType=d,g()}})}),d.find("input[name='customlink']").change(function(){var a=$(this).parents("li.ctrl-item-list-li").index();b.content.dataset[a].link=$(this).val()}),d.find(".j-moveup").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();if(0!=a){var c=b.content.dataset.slice(a,a+1)[0];b.content.dataset.splice(a,1),b.content.dataset.splice(a-1,0,c),g()}}),d.find(".j-movedown").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index(),c=b.content.dataset.length;if(a!=c-1){var d=b.content.dataset.slice(a,a+1)[0];b.content.dataset.splice(a,1),b.content.dataset.splice(a+1,0,d),g()}}),d.find(".ctrl-item-list-add").click(function(){var a={linkType:0,link:"",title:"",showtitle:""};b.content.dataset.push(a),g()}),d.find(".j-del").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();b.content.dataset.splice(a,1),g()})},HYD.DIY.Unit.event_type8=function(a,b){var c=b.dom_conitem,d=a,e=$("#tpl_diy_con_type8").html(),f=$("#tpl_diy_ctrl_type8").html();b.dom_ctrl=a;var g=function(a){var g=$(_.template(e,b));c.find(".members_con").remove().end().append(g);var h=$(_.template(f,b));d.empty().append(h),HYD.DIY.Unit.event_type8(d,b),a&&a()},h=function(){$(".members_nav1 ul li").each(function(a,b){var c=$(this),d=c.find("img").width();c.find("img").height(d)})};d.find("input[name='title']").change(function(){var a=$(this).parents("li.ctrl-item-list-li").index();b.content.dataset[a].showtitle=$(this).val(),g()}),d.find(".droplist li").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();HYD.popbox.dplPickerColletion({linkType:$(this).data("val"),callback:function(c,d){b.content.dataset[a].title=c.title,b.content.dataset[a].showtitle=c.title,b.content.dataset[a].link=c.link,b.content.dataset[a].linkType=d,c.pic&&""!=c.pic&&(b.content.dataset[a].pic=c.pic),g(h)}})}),d.find(".j-selectimg").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();HYD.popbox.ImgPicker(function(c){b.content.dataset[a].pic=c[0],g(h)})}),d.find("input[name='customlink']").change(function(){var a=$(this).parents("li.ctrl-item-list-li").index();b.content.dataset[a].link=$(this).val()}),d.find(".j-moveup").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();if(0!=a){var c=b.content.dataset.slice(a,a+1)[0];b.content.dataset.splice(a,1),b.content.dataset.splice(a-1,0,c),g()}}),d.find(".j-movedown").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index(),c=b.content.dataset.length;if(a!=c-1){var d=b.content.dataset.slice(a,a+1)[0];b.content.dataset.splice(a,1),b.content.dataset.splice(a+1,0,d),g()}}),d.find(".ctrl-item-list-add").click(function(){var a={linkType:0,link:"",title:"",showtitle:"",pic:""};b.content.dataset.push(a),g()}),d.find(".j-del").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();b.content.dataset.splice(a,1),g()})},HYD.DIY.Unit.event_type9=function(a,b){var c=b.dom_conitem,d=a,e=$("#tpl_diy_con_type9").html(),f=$("#tpl_diy_ctrl_type9").html();b.dom_ctrl=a;var g=function(){var a=$(_.template(e,b));c.find(".members_con").remove().end().append(a);var g=$(_.template(f,b));d.empty().append(g),HYD.DIY.Unit.event_type9(d,b)};d.find("input[name='title']").change(function(){var a=$(this).parents("li.ctrl-item-list-li").index();b.content.dataset[a].showtitle=$(this).val(),g()}),d.find("input[name='showType']").change(function(){b.content.showType=$(this).val(),g()}),d.find("input[name='space']").change(function(){b.content.space=$(this).val(),g()}),d.find("#slider").slider({min:0,max:20,step:1,animate:"fast",value:b.content.margin,slide:function(a,b){c.find(".members_imgad ul li").css("margin-bottom",b.value),d.find(".j-ctrl-showheight").text(b.value+"px")},stop:function(a,c){b.content.margin=parseInt(c.value)}}),d.find(".droplist li").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();HYD.popbox.dplPickerColletion({linkType:$(this).data("val"),callback:function(c,d){b.content.dataset[a].title=c.title,b.content.dataset[a].showtitle=c.title,b.content.dataset[a].link=c.link,b.content.dataset[a].linkType=d,c.pic&&""!=c.pic&&(b.content.dataset[a].pic=c.pic),g()}})}),d.find(".j-selectimg").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();HYD.popbox.ImgPicker(function(c){b.content.dataset[a].pic=c[0],g()})}),d.find("input[name='customlink']").change(function(){var a=$(this).parents("li.ctrl-item-list-li").index();b.content.dataset[a].link=$(this).val()}),d.find(".j-moveup").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();if(0!=a){var c=b.content.dataset.slice(a,a+1)[0];b.content.dataset.splice(a,1),b.content.dataset.splice(a-1,0,c),g()}}),d.find(".j-movedown").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index(),c=b.content.dataset.length;if(a!=c-1){var d=b.content.dataset.slice(a,a+1)[0];b.content.dataset.splice(a,1),b.content.dataset.splice(a+1,0,d),g()}}),d.find(".ctrl-item-list-add").click(function(){var a={linkType:0,link:"",title:"",showtitle:"",pic:""};b.content.dataset.push(a),g()}),d.find(".j-del").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();b.content.dataset.splice(a,1),g()})},HYD.DIY.Unit.event_type11=function(a,b){var c=b.dom_conitem,d=a;$("#tpl_diy_con_type11").html(),$("#tpl_diy_ctrl_type11").html();b.dom_ctrl=a;d.find("#slider").slider({min:10,max:100,step:1,animate:"fast",value:b.content.height,slide:function(a,b){c.find(".custom-space").css("height",b.value),d.find(".j-ctrl-showheight").text(b.value+"px")},stop:function(a,c){b.content.height=parseInt(c.value)}})},HYD.DIY.Unit.event_type12=function(a,b){var c=b.dom_conitem,d=a,e=$("#tpl_diy_con_type12").html(),f=$("#tpl_diy_ctrl_type12").html();b.dom_ctrl=a;var g=function(){var a=$(_.template(e,b));c.find(".Header_style12_panel").remove().end().append(a);var g=$(_.template(f,b));d.empty().append(g),HYD.DIY.Unit.event_type12(d,b)};d.find("input[name='navtitle']").change(function(){var a=$(this).parents("li.ctrl-item-list-li").index(),c=$(this).val();b.content.dataset[a].showtitle=c,g()}),d.find(".droplist li").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();HYD.popbox.dplPickerColletion({linkType:$(this).data("val"),callback:function(c,d){b.content.dataset[a].title=c.title,b.content.dataset[a].showtitle=c.title,b.content.dataset[a].link=c.link,b.content.dataset[a].linkType=d,c.pic&&""!=c.pic&&(b.content.dataset[a].pic=c.pic),g()}})}),d.find(".j-selectimg").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();HYD.popbox.ImgPicker(function(c){b.content.dataset[a].pic=c[0],g()})}),d.find("input[name='customlink']").change(function(){var a=$(this).parents("li.ctrl-item-list-li").index();b.content.dataset[a].link=$(this).val()}),d.find("select[name='navbgColor']").change(function(){var a=$(this).parents("li.ctrl-item-list-li").index(),c=$(this).val();b.content.dataset[a].bgColor=c,g()}),d.find('input[name="showstyle"]').change(function(a){var c=$(this),d=c.val();b.content.style=d,g()}),d.find('input[name="marginstyle"]').change(function(a){var c=$(this),d=c.val();b.content.marginstyle=d,g()}),d.find(".ctrl-item-list-li").each(function(a,c){var d=$(this);d.find(".colorPicker").each(function(c,d){var e=$(this);if(0==c){var f=$(this).data("name"),h=$(this).data("color"),i="#j_clp_col"+f;e.ColorPicker({color:h,onShow:function(a){return $(a).fadeIn(100),!1},onHide:function(a){return $(a).fadeOut(100),g(),!1},onChange:function(c,d,f){var d="#"+d;e.css("background-color",d),b.content.dataset[a].bgColor=d}})}else{var f=$(this).data("name"),h=$(this).data("color"),i="#j_clp_col"+f;e.ColorPicker({color:h,onShow:function(a){return $(a).fadeIn(100),!1},onHide:function(a){return $(a).fadeOut(100),g(),!1},onChange:function(c,d,e){var d="#"+d;$(i).css("background-color",d),b.content.dataset[a].fotColor=d}})}})}),d.find(".j-uploadIcon").click(function(a){var c=$(this).parents("li.ctrl-item-list-li").index();HYD.popbox.ImgPicker(function(a){b.content.dataset[c].pic=a[0],g()})}),d.find(".j-navModifyIcon").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();HYD.popbox.IconPicker(function(c){console.log(c),b.content.dataset[a].pic=c[0],g()})}),d.find(".j-moveup").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();if(0!=a){var c=b.content.dataset.slice(a,a+1)[0];b.content.dataset.splice(a,1),b.content.dataset.splice(a-1,0,c),g()}}),d.find(".j-movedown").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index(),c=b.content.dataset.length;if(a!=c-1){var d=b.content.dataset.slice(a,a+1)[0];b.content.dataset.splice(a,1),b.content.dataset.splice(a+1,0,d),g()}}),d.find(".ctrl-item-list-add").click(function(){var a={linkType:0,link:"",title:"",showtitle:"",pic:""};b.content.dataset.push(a),g()}),d.find(".j-del").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();b.content.dataset.splice(a,1),g()})},HYD.DIY.Unit.event_type13=function(a,b){var c=b.dom_conitem,d=a,e=$("#tpl_diy_con_type13").html(),f=$("#tpl_diy_ctrl_type13").html();b.dom_ctrl=a;var g=function(a){var g=$(_.template(e,b));c.find(".members_con").remove().end().append(g);var h=$(_.template(f,b));d.empty().append(h),HYD.DIY.Unit.event_type13(d,b),a&&a()},h=function(){var a=$("input[name=layout]:checked").val();1==parseInt(a)?$(".board3").each(function(a,b){var c=$(this),d=c.width();c.height(d).css("overflow","hidden")}):$(".board3").each(function(a,b){var c=$(this),d=c.width();(c.hasClass("small_board")||!c.hasClass("big_board"))&&c.children("span").attr("style","height:"+d+"px !important;overflow:hidden;"),c.hasClass("big_board")&&c.children("span").attr("style","height:"+(2*d+10)+"px !important;overflow:hidden;")})};d.find('input[name="layout"]').change(function(a){var c=$(this),d=c.val();b.content.layout=d,g(h)}),d.find("input[name='title']").change(function(){var a=$(this).parents("li.ctrl-item-list-li").index();b.content.dataset[a].showtitle=$(this).val(),g()}),d.find(".droplist li").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();HYD.popbox.dplPickerColletion({linkType:$(this).data("val"),callback:function(c,d){b.content.dataset[a].title=c.title,b.content.dataset[a].showtitle=c.title,b.content.dataset[a].link=c.link,b.content.dataset[a].linkType=d,c.pic&&""!=c.pic&&(b.content.dataset[a].pic=c.pic),g()}})}),d.find(".j-selectimg").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();HYD.popbox.ImgPicker(function(c){b.content.dataset[a].pic=c[0],g(h)})}),d.find("input[name='customlink']").change(function(){var a=$(this).parents("li.ctrl-item-list-li").index();b.content.dataset[a].link=$(this).val()}),d.find(".j-moveup").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();if(0!=a){var c=b.content.dataset.slice(a,a+1)[0];b.content.dataset.splice(a,1),b.content.dataset.splice(a-1,0,c),g()}}),d.find(".j-movedown").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index(),c=b.content.dataset.length;if(a!=c-1){var d=b.content.dataset.slice(a,a+1)[0];b.content.dataset.splice(a,1),b.content.dataset.splice(a+1,0,d),g()}}),d.find(".ctrl-item-list-add").click(function(){var a={linkType:0,link:"",title:"",showtitle:"",pic:""};b.content.dataset.push(a),g()}),d.find(".j-del").click(function(){var a=$(this).parents("li.ctrl-item-list-li").index();b.content.dataset.splice(a,1),g()})},HYD.DIY.Unit.event_type14=function(a,b){var c=b.dom_conitem,d=a,e=$("#tpl_diy_con_type14").html(),f=$("#tpl_diy_ctrl_type14").html();b.dom_ctrl=a;var g=function(a){var g=$(_.template(e,b));c.find(".members_con").remove().end().append(g);var h=$(_.template(f,b));d.empty().append(h),HYD.DIY.Unit.event_type14(d,b),g.find("iframe").attr("src",a)},h=function(a){var b,c,d,e=/vid\=([^\&]*)($|\&)+/g,f=/sid\/\w*.*?/g;return c=a.match(e),d=a.match(f),c&&(c=c.toString(),b="http://v.qq.com/iframe/player.html?"+c+"&tiny=0&auto=0"),d&&(d=d.toString(),d=d.split("/v.swf"),d=d.toString(),d=d.replace("sid/","").replace(",",""),b="http://player.youku.com/embed/"+d),null===c&&null===d?(HYD.hint("danger","请填写正确的视频网址"),!1):b};d.find(".j-getvideo").click(function(a){var c=$(this).prev("input").val();b.content.website=c;var d=h(c);g(d)})},HYD.DIY.Unit.event_type15=function(a,b){var c=b.dom_conitem,d=a,e=$("#tpl_diy_con_type15").html(),f=$("#tpl_diy_ctrl_type15").html();b.dom_ctrl=a;var g=function(a){var g=$(_.template(e,b));c.find(".members_con").remove().end().append(g);var h=$(_.template(f,b));d.empty().append(h),HYD.DIY.Unit.event_type15(d,b)},h=function(a){var c,d=$("#tpl_popbox_Audio").html(),e=$(d),f=function(a,b){var d=function(a){if(c=a.list,c&&c.length){var d=_.template($("#tpl_popbox_ImgPicker_audio").html(),{dataset:c}),g=$(d);g.filter("li").click(function(){$(this).addClass("selected").siblings("li").removeClass("selected")}),g.find(".audio-name").click(function(a){return!1}),g.find(".j-get-edit-name").click(function(a){return $(this).hide().siblings(".j-edit-name").show(),$(this).siblings(".j-edit-name").find("input").focus(),!1}),g.find(".j-getAudioName").click(function(a){var b=$(this),c=b.siblings('input[name="audioName"]').val(),d=b.data("id");$.ajax({url:"/Design/renameImg",type:"POST",dataType:"json",data:{file_id:d,file_name:c},success:function(a){1==a.status&&(HYD.hint("success","恭喜您，修改音频名称成功！"),b.closest(".j-edit-name").hide().siblings(".j-curname").html(c))}})}),e.find(".imgpicker-list").empty().append(g);var h=a.page,i=$(h);i.filter("a:not(.disabled,.cur)").click(function(){var a=$(this).attr("href"),b=a.split("/");return b=b[b.length-1],b=b.replace(/.html/,""),f(b),!1}),e.find(".paginate").empty().append(i)}else e.find(".imgpicker-list").append("<p class='txtCenter'>对不起，暂无音频</p>");b&&b()};$.ajax({url:"/Design/getMediaList",type:"post",dataType:"json",data:{p:parseInt(a),type:"voice"},success:function(a){1==a.status?d(a):HYD.hint("danger","对不起，获取数据失败："+a.msg)}})},h=function(a){var c=[],d=[];e.find("#imgpicker_upload_input").uploadify({debug:!1,auto:!0,formData:{PHPSESSID:$.cookie("PHPSESSID"),type:"voice"},width:60,height:60,multi:!0,swf:"/Public/plugins/uploadify/uploadify.swf",uploader:"/Design/uploadMedia",buttonText:"+",fileSizeLimit:"5MB",fileTypeExts:"*.mp3; *.wma; *.wav; *.amr",onSelectError:function(a,b,c){switch(b){case-100:HYD.hint("danger","对不起，系统只允许您一次最多上传10个文件");break;case-110:HYD.hint("danger","对不起，文件 ["+a.name+"] 大小超出5MB！");break;case-120:HYD.hint("danger","文件 ["+a.name+"] 大小异常！");break;case-130:HYD.hint("danger","文件 ["+a.name+"] 类型不正确！")}},onFallback:function(){HYD.hint("danger","您未安装FLASH控件，无法上传图片！请安装FLASH控件后再试。")},onUploadSuccess:function(a,b,f){var b=$.parseJSON(b),g=$("#tpl_popbox_ImgPicker_audio2").html(),h=e.find(".imgpicker-upload-preview"),i=b.file_path,j=b.file_id;c.push(i),d.push(j);var k=_.template(g,{url:i,id:j}),l=$(k);l.find(".j-imgpicker-upload-btndel").click(function(){var a=e.find(".imgpicker-upload-preview li").index($(this).parent("li"));l.fadeOut(300,function(){c.splice(a,1),$(this).remove()})}),h.append(l)},onUploadError:function(a,b,c,d){HYD.hint("danger","对不起："+a.name+"上传失败："+d)}}),e.find("#j-btn-uploaduse").click(function(){0==c.length?HYD.hint("danger","对不起，您没有选择音频："+b.msg):(b.content.audiosrc=c[0],g()),$.jBox.close(a)})};f(1,function(){$.jBox.show({title:"选择音频",content:e,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(d){var f=e.find("#j-btn-listuse"),g=e.find("#j-btn-listdel");f.click(function(){var f=[],g=[];e.find(".imgpicker-list li.selected").each(function(){f.push(c[$(this).index()].file_path),g.push(c[$(this).index()].file_id)}),0==f.length?HYD.hint("danger","对不起，您没有选择音频："+b.msg):a&&a(f),$.jBox.close(d)}),g.click(function(){var a=e.find(".imgpicker-list li.selected").children(".audio-flag").data("id");$.ajax({url:"/Design/delImg",type:"POST",dataType:"json",data:{file_id:a},success:function(a){1==a.status&&(HYD.hint("success","删除成功"),e.find(".imgpicker-list li.selected").remove())}})}),e.find(".j-initupload").one("click",function(){h(d)})}})})};d.find(".j-selectimg").click(function(){$(this).parents("li.ctrl-item-list-li").index();HYD.popbox.ImgPicker(function(a){b.content.imgsrc=a[0],g()})}),d.find(".j-audioselect").click(function(){h(function(a){b.content.audiosrc=a[0],g()})})}}),$(function(){HYD.DIY.Unit.verifyWhiteList=["1","6","10","11","12","13","14","15","Header_style1","Header_style2","Header_style3","Header_style4","Header_style5","Header_style6","Header_style7","Header_style8","Header_style9","Header_style10","Header_style11","Header_style12","Header_style13","Header_style14","Header_style15","Header_style16","Header_style17","Header_style18","Header_style19","Header_style20","Header_style7_news","Header_style9_news","Header_style12_ad","Header_style12_nav","Header_style15_news","UserCenter","Navigation","MgzCate","GoodsGroup"],HYD.DIY.Unit.verify_type2=function(a){var b=!1,c=!0,d=function(){b||(a.dom_conitem.find(".diy-conitem-action").click(),b=!0,c=!1)};if(""==a.content.title){d();var e=a.dom_ctrl.find("input[name='title']");HYD.FormShowError(e,"请填写标题")}if(""==a.content.subtitle){d();var e=a.dom_ctrl.find("input[name='subtitle']");HYD.FormShowError(e,"请填写副标题")}return c},HYD.DIY.Unit.verify_type3=function(a){var b=!1,c=!0,d=function(){b||(a.dom_conitem.find(".diy-conitem-action").click(),b=!0,c=!1)};if(!a.content){d();var e=a.dom_ctrl.find(".j-verify");HYD.FormShowError(e,"请选择一个自定义模块")}return c},HYD.DIY.Unit.verify_type4=function(a){var b=!1,c=!0,d=function(){b||(a.dom_conitem.find(".diy-conitem-action").click(),b=!0,c=!1)};if(!a.content.goodslist.length){d();var e=a.dom_ctrl.find(".j-verify");HYD.FormShowError(e,"请至少选择一件产品")}return c},HYD.DIY.Unit.verify_type5=function(a){var b=!1,c=!0,d=function(){b||(a.dom_conitem.find(".diy-conitem-action").click(),b=!0,c=!1)};if(!a.content.group){d();var e=a.dom_ctrl.find(".j-verify");HYD.FormShowError(e,"请选择产品分组")}return c},HYD.DIY.Unit.verify_type7=function(a){var b=!1,c=!0,d=function(){b||(a.dom_conitem.find(".diy-conitem-action").click(),b=!0,c=!1)};a.content.dataset.length||(d(),a.dom_ctrl.find(".j-verify-least").addClass("error").text("请至少添加一个导航链接"));for(var e=0;e<a.content.dataset.length;e++){var f=a.content.dataset[e];if(""==f.showtitle){d();var g=a.dom_ctrl.find(".ctrl-item-list-li:eq("+e+") input[name='title']");HYD.FormShowError(g,"请输入导航名称")}0==f.linkType&&(d(),a.dom_ctrl.find(".ctrl-item-list-li:eq("+e+") .j-verify-linkType").addClass("error").text("请选择要链接的地址"))}return c},HYD.DIY.Unit.verify_type8=function(a){var b=!1,c=!0,d=function(){b||(a.dom_conitem.find(".diy-conitem-action").click(),b=!0,c=!1)};a.content.dataset.length||(d(),a.dom_ctrl.find(".j-verify-least").addClass("error").text("请至少添加一个图片导航"));for(var e=0;e<a.content.dataset.length;e++){var f=a.content.dataset[e];if(""==f.showtitle){d();var g=a.dom_ctrl.find(".ctrl-item-list-li:eq("+e+") input[name='title']");HYD.FormShowError(g,"请输入导航名称")}0==f.linkType&&(d(),a.dom_ctrl.find(".ctrl-item-list-li:eq("+e+") .j-verify-linkType").addClass("error").text("请选择要链接的地址")),""==f.pic&&(d(),a.dom_ctrl.find(".ctrl-item-list-li:eq("+e+") .j-verify-pic").addClass("error").text("请选择一张图片"))}return c},HYD.DIY.Unit.verify_type9=function(a){var b=!1,c=!0,d=function(){b||(a.dom_conitem.find(".diy-conitem-action").click(),b=!0,c=!1)};a.content.dataset.length||(d(),a.dom_ctrl.find(".j-verify-least").addClass("error").text("请至少添加一个图片广告"));for(var e=0;e<a.content.dataset.length;e++){var f=a.content.dataset[e];0==f.linkType&&(d(),a.dom_ctrl.find(".ctrl-item-list-li:eq("+e+") .j-verify-linkType").addClass("error").text("请选择要链接的地址")),""==f.pic&&(d(),a.dom_ctrl.find(".ctrl-item-list-li:eq("+e+") .j-verify-pic").addClass("error").text("请选择一张图片"))}return c},HYD.DIY.Unit.verify=function(){var a=HYD.DIY.Unit.verifyWhiteList,b=!0,c=HYD.DIY.LModules.length,d=HYD.DIY.PModules.length;if(c)for(var e=0;c>e;e++){var f=HYD.DIY.LModules[e];if(a.indexOf(f.type.toString())<0&&!HYD.DIY.Unit["verify_type"+f.type](f)){b=!1;break}}if(d)for(var e=0;d>e;e++){var f=HYD.DIY.PModules[e];if(a.indexOf(f.type.toString())<0&&!HYD.DIY.Unit["verify_type"+f.type](f)){b=!1;break}}return b}}),$(function(){$(".j-diy-addModule").click(function(){var a=$(this).data("type"),b={id:HYD.DIY.getTimestamp(),type:a,draggable:!0,sort:0,content:null};switch(a){case 1:b.ue=null,b.content={fulltext:"&lt;p&gt;『富文本编辑器』&lt;/p&gt;"};break;case 2:b.content={title:"标题名称",subtitle:"『副标题』",direction:"left",space:0};break;case 3:break;case 4:b.content={layout:1,showPrice:!0,showIco:!0,showName:1,goodslist:[]};break;case 5:b.content={layout:1,showPrice:!0,showIco:!0,showName:!0,group:null,goodsize:6,goodslist:[{item_id:"1",link:"#",pic:"/Public/images/diy/goodsView1.jpg",price:"100.00",title:"第一个产品"},{item_id:"2",link:"#",pic:"/Public/images/diy/goodsView2.jpg",price:"200.00",title:"第二个产品"},{item_id:"3",link:"#",pic:"/Public/images/diy/goodsView3.jpg",price:"300.00",title:"第三个产品"},{item_id:"4",link:"#",pic:"/Public/images/diy/goodsView4.jpg",price:"400.00",title:"第四个产品"}]};break;case 6:break;case 7:b.content={dataset:[{linkType:0,link:"",title:"",showtitle:""}]};break;case 8:b.content={dataset:[{linkType:0,link:"#",title:"导航名称",showtitle:"导航名称",pic:"/Public/images/diy/waitupload.png"},{linkType:0,link:"#",title:"导航名称",showtitle:"导航名称",pic:"/Public/images/diy/waitupload.png"},{linkType:0,link:"#",title:"导航名称",showtitle:"导航名称",pic:"/Public/images/diy/waitupload.png"},{linkType:0,link:"#",title:"导航名称",showtitle:"导航名称",pic:"/Public/images/diy/waitupload.png"}]};break;case 9:b.content={showType:1,space:0,margin:10,dataset:[]};break;case 10:break;case 11:b.content={height:10};break;case 12:b.content={style:"0",marginstyle:"0",dataset:[{link:"/Shop/index",linkType:6,showtitle:"首页",title:"商城主页",pic:"/PublicMob/images/ind3_1.png",bgColor:"#07a0e7",cloPicker:"0",fotColor:"#fff"},{link:"/Shop/index",linkType:6,showtitle:"新品",title:"",pic:"/PublicMob/images/ind3_2.png",bgColor:"#72c201",cloPicker:"1",fotColor:"#fff"},{link:"/Shop/index",linkType:6,showtitle:"热卖",title:"商城主页",pic:"/PublicMob/images/ind3_3.png",bgColor:"#ffa800",cloPicker:"2",fotColor:"#fff"},{link:"/Shop/index",linkType:6,showtitle:"推荐",title:"",pic:"/PublicMob/images/ind3_4.png",bgColor:"#d50303",cloPicker:"3",fotColor:"#fff"}]};break;case 13:b.content={layout:"1",dataset:[{linkType:0,link:"#",title:"导航名称",pic:"/Public/images/diy/waitupload.png"},{linkType:0,link:"#",title:"导航名称",pic:"/Public/images/diy/waitupload.png"},{linkType:0,link:"#",title:"导航名称",pic:"/Public/images/diy/waitupload.png"}]};break;case 14:b.content={website:""};break;case 15:b.content={direct:0,imgsrc:"",audiosrc:""}}HYD.DIY.add(b,!0)}),$("#diy-phone .drag").sortable({revert:!0,placeholder:"drag-highlight",stop:function(a,b){HYD.DIY.repositionCtrl(b.item,$(".diy-ctrl-item[data-origin='item']"))}}).disableSelection(),$(".j-pagetitle").click(function(){$(".diy-ctrl-item[data-origin='pagetitle']").show().siblings(".diy-ctrl-item[data-origin='item']").hide()}),$(".j-pagetitle-ipt").change(function(){$(".j-pagetitle").text($(this).val())})});