$(function(){$(document).on("click",".j-valTxt",function(){return!1}),$(document).on("dblclick",".j-valTxt",function(){return $(this).hide(),$(this).siblings("input.j-val-ipt").show().focus(),!1}),$(document).on("click",".j-edit",function(){return $(this).parent("span").siblings(".j-valTxt").hide(),$(this).parent("span").siblings("input.j-val-ipt").show().focus(),!1}),$(document).on("blur",".j-val-ipt",function(){var a=$(this),b=a.parent("li").data("id"),c=$(".j-cateMain .cate-item.selected").data("id"),d=a.val(),e=a.parents(".cate").data("level");switch(e){case"main":var f={id:b,val:d};break;case"second":var f={id:b,parent_id:c,val:d}}return a.hide(),a.siblings(".j-valTxt").text(d).show(),$.ajax({url:"/Category/editCategory",type:"post",dataType:"json",data:f,success:function(b){1==b.status?(a.hide(),a.siblings(".j-valTxt").text(d).show()):HYD.hint("danger","对不起，更新失败："+b.msg)}}),!1}),$(document).on("click",".j-del",function(){var a=$(this).parents("ul.cate").data("level"),b=$(this).parents("li"),c=b.data("id"),d="";switch(a){case"main":d="删除一级类目同时会删除其下的二级类目，是否继续？";break;case"second":d="删除后将不可恢复，是否继续？"}return $.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:d}),btnOK:{onBtnClick:function(d){$.jBox.close(d),$.ajax({url:"/Category/delCategory",type:"post",dataType:"json",data:{id:c},beforeSend:function(){$.jBox.showloading()},success:function(c){1==c.status?(b.remove(),"main"==a&&$(".j-cateSecond .cate-item").remove()):HYD.hint("danger","对不起，删除失败："+c.msg),$.jBox.hideloading()}})}}}),!1}),$(document).on("click",".j-cateMain .cate-item",function(){var a=$(this),b=a.data("id");return a.addClass("selected").siblings("li").removeClass("selected"),$.ajax({url:"/Category/ajax_category",type:"post",dataType:"json",data:{id:b},success:function(a){if($(".j-cateSecond li").not(":eq(0)").remove(),1==a.status){var b=_.template($("#tpl_cate_simple_item").html(),{dataset:a.data});$(b).insertAfter(".j-addSecond")}}}),!1}),$(document).on("click",".j-addMain,.j-addSecond",function(){var a=$("#tpl_cate_simple_item").html(),b=$(this),c=b.data("level"),d={val:""};return"second"==c&&(d.parent_id=$(".j-addMain .cate-item.selected").data("id")),console.log(d),$.ajax({url:"/Category/addCategory",type:"post",dataType:"json",data:d,success:function(c){if(1==c.status){var e=[];d.category_id=c.data,e.push(d);var f=_.template(a,{dataset:e}),g=$(f);b.parent("ul").append(g),g.find(".j-valTxt").hide(),g.find(".j-val-ipt").show().focus()}}}),!1})});