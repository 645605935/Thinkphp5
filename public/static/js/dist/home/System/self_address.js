var pickerCity=function(a,b){$.ajax({url:"/System/getCity",type:"post",dataType:"json",data:{province_id:a},success:function(a){1==a.status&&b&&b(a.data)}})},pickerArea=function(a,b){$.ajax({url:"/System/getArea",type:"post",dataType:"json",data:{city_id:a},success:function(a){1==a.status&&b&&b(a.data)}})};$(function(){$(".j-self").click(function(){var a=$("#tpl_self").html(),b=$(a);b.find(".s_province").change(function(){var a=b.find(".s_province").val(),c='<option value="0">请选择</option>';pickerCity(a,function(a){$.each(a,function(a,b){c+="<option value='"+b.city_id+"'>"+b.city_name+"</option>"}),$(".s_city").empty().append(c)})}),b.find(".s_city").change(function(){var a=b.find(".s_city").val(),c='<option value="0">请选择</option>';pickerArea(a,function(a){$.each(a,function(a,b){c+="<option value='"+b.area_id+"'>"+b.area_name+"</option>"}),$(".s_area").empty().append(c)})}),$.jBox.show({width:500,title:"添加自提地址",content:b,btnOK:{onBtnClick:function(a){var c=b.find("input[name='name']"),d=b.find("input[name='mobile']"),e=b.find("input[name ='phone']"),f=b.find("select[name='province_id']"),g=b.find("select[name='city_id']"),h=b.find("select[name='area_id']"),i=b.find("textarea[name='address']"),j=b.find("input[name='shop_name']"),k=c.val(),l=d.val(),m=e.val(),n=j.val(),o=f.val(),p=g.val(),q=h.val(),r=i.val(),s=/^1[34578]{1}\d{9}$/;return""==k?void HYD.FormShowError(c,"联系人姓名不能为空"):""==l?void HYD.FormShowError(d,"手机号不能为空"):s.test(l)?0==o?void HYD.FormShowError(f,"请选择省份"):0==p?void HYD.FormShowError(g,"请选择城市"):0==q?void HYD.FormShowError(h,"请选择地区"):""==r?void HYD.FormShowError(i,"请填写详细地址"):($.jBox.close(a),void $.ajax({url:"/System/addSelfAddress",type:"post",dataType:"json",data:{name:k,mobile:l,phone:m,province_id:o,city_id:p,area_id:q,address:r,shop_name:n},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，添加成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，添加失败："+a.msg),$.jBox.hideloading()}})):void HYD.FormShowError(d,"手机号格式错误")}}})}),$(".j-edit").click(function(){var a=$(this),b=a.data("id"),c=a.data("province"),d=a.data("city"),e=a.data("area");defaults={mobile:a.data("mobile")||"",phone:a.data("phone")||"",address:a.data("address"),name:a.data("name"),shop_name:a.data("shopname"),province:c,city:d,area:e},pickerCity(c,function(a){var b='<option value="0">请选择</option>';$.each(a,function(a,c){b+=c.city_id==d?"<option value='"+c.city_id+"' selected>"+c.city_name+"</option>":"<option value='"+c.city_id+"'>"+c.city_name+"</option>"}),$(".s_city").empty().append(b)}),pickerArea(d,function(a){var b='<option value="0">请选择</option>';$.each(a,function(a,c){b+=c.area_id==e?"<option value='"+c.area_id+"' selected>"+c.area_name+"</option>":"<option value='"+c.area_id+"'>"+c.area_name+"</option>"}),$(".s_area").empty().append(b)});var f=_.template($("#tpl_self_edit").html(),defaults),g=$(f);return g.find(".s_province").change(function(){var a=g.find(".s_province").val(),b='<option value="0">请选择</option>';pickerCity(a,function(a){$.each(a,function(a,c){b+="<option value='"+c.city_id+"'>"+c.city_name+"</option>"}),$(".s_city").empty().append(b)})}),g.find(".s_city").change(function(){var a=g.find(".s_city").val(),b='<option value="0">请选择</option>';pickerArea(a,function(a){$.each(a,function(a,c){b+="<option value='"+c.area_id+"'>"+c.area_name+"</option>"}),$(".s_area").empty().append(b)})}),$.jBox.show({width:500,title:"自提地址",content:g,btnOK:{onBtnClick:function(a){var c=g.find("input[name='name']"),d=g.find("input[name='mobile']"),e=g.find("input[name ='phone']"),f=g.find("select[name='province_id']"),h=g.find("select[name='city_id']"),i=g.find("select[name='area_id']"),j=g.find("textarea[name='address']"),k=g.find("input[name='shop_name']"),l=c.val(),m=d.val(),n=e.val(),o=k.val(),p=f.val(),q=h.val(),r=i.val(),s=j.val(),t=/^1[34578]{1}\d{9}$/;return""==l?void HYD.FormShowError(c,"联系人姓名不能为空"):""==m?void HYD.FormShowError(d,"手机号不能为空"):t.test(m)?0==p?void HYD.FormShowError(f,"请选择省份"):0==q?void HYD.FormShowError(h,"请选择城市"):0==r?void HYD.FormShowError(i,"请选择地区"):""==s?void HYD.FormShowError(j,"请填写详细地址"):($.jBox.close(a),void $.ajax({url:"/System/editSelfAddress",type:"post",dataType:"json",data:{self_address_id:b,name:l,mobile:m,phone:n,province_id:p,city_id:q,area_id:r,address:s,shop_name:o},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，编辑成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，编辑失败："+a.msg),$.jBox.hideloading()}})):void HYD.FormShowError(d,"手机号格式错误")}}}),!1}),$(".j-del").click(function(){var a=$(this).data("id");return $.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"删除后将不可恢复，是否继续？"}),btnOK:{onBtnClick:function(b){$.jBox.close(b),$.ajax({url:"/System/delSelfAddress",type:"post",dataType:"json",data:{id:a},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜，删除成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","抱歉，删除失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".btn_table_delAll").click(function(){var a=[],b=$(".table-ckbs:checked");return b.each(function(){a.push($(this).data("id"))}),a.length?($.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"删除后将不可恢复，是否继续？"}),btnOK:{onBtnClick:function(b){$.jBox.close(b),$.ajax({url:"/System/batchDelSelfAddress",type:"post",dataType:"json",data:{id:a},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜，批量删除成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","抱歉，批量删除失败："+a.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择要关闭的订单！")})});