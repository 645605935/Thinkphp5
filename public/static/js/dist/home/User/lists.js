$(function(){$(".j-qrcode").click(function(){var a=$(this).data("link");HYD.showQrcode("/Public/qrcode?link="+a)}),$(".j-setLevel").click(function(){var a=$(this),b=a.data("id"),c={rank:a.data("rank"),name:a.data("name")},d=_.template($("#tpl_user_lists_setlevel").html(),c),e=$(d),f=e.find("select[name='rank']");return $.jBox.show({width:500,title:"设置会员等级",content:e,btnOK:{onBtnClick:function(a){var c=f.val();$.jBox.close(a),$.ajax({url:"/User/setRank",type:"post",dataType:"json",data:{user_id:b,rank_id:c},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，设置成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，设置失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-setUsersLevel").click(function(){var a=[],b=$(".table-ckbs:checked");if(b.each(function(){a.push($(this).data("id"))}),!a.length)return void HYD.hint("warning","对不起，请选择需要设置的会员！");var c={rank:1},d=_.template($("#tpl_user_lists_alllevel").html(),c),e=$(d),f=e.find("select[name='rank']");return $.jBox.show({title:"批量设置用户等级",content:e,btnOK:{onBtnClick:function(b){var c=f.val();$.jBox.close(b),$.ajax({url:"/User/betchRank",type:"post",dataType:"json",data:{ids:a,rank_id:c},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，设置成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，设置失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-gavePoint").click(function(){var a=$(this),b=a.data("id"),c=a.data("user_id"),d={name:a.data("name"),now_point:a.data("point")},e=_.template($("#tpl_user_lists_gavePoint").html(),d),f=$(e),g=f.find("input[name='point']"),h=f.find("textarea[name='remark']");return $.jBox.show({title:"调整积分",content:f,btnOK:{onBtnClick:function(a){var d=parseInt(g.val()),e=h.val();return isNaN(d)||0==d?void HYD.FormShowError(g,"请输入不为0整数"):($.jBox.close(a),void $.ajax({url:"/User/sendPoint",type:"post",dataType:"json",data:{id:b,user_id:c,point:d,remark:e},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，积分调整成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，积分调整失败："+a.msg),$.jBox.hideloading()}}))}}}),!1}),$(".j-redPack").click(function(){var a=$(this),b=a.data("user_id"),c={name:a.data("name")},d=_.template($("#tpl_user_lists_redPack").html(),c),e=$(d),f=e.find("input[name='total_amount']"),g=e.find("input[name='wishing']");return $.jBox.show({title:"发红包",content:e,btnOK:{onBtnClick:function(a){var c=parseFloat(f.val()),d=g.val();return isNaN(c)||1>c||c>200?void HYD.FormShowError(f,"红包金额介于[1.00元，200.00元]之间"):d?($.jBox.close(a),void $.ajax({url:"/User/sendRedPack",type:"post",dataType:"json",data:{user_id:b,total_amount:c,wishing:d},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜，红包发放成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","抱歉，红包发放失败："+a.msg,2e3),$.jBox.hideloading()}})):void HYD.FormShowError(g,"祝福语不能为空")}}}),!1}),$(".j-edit").click(function(){var a=$(this),b=a.data("id");defaults={mobile:a.data("mobile")||"",email:a.data("email"),name:a.data("name"),user_remark:a.data("remark")};var c=_.template($("#tpl_user_detail_modify").html(),defaults),d=$(c),e=d.find("input[name='name']"),f=d.find("input[name='email']"),g=d.find("input[name='mobile']"),h=d.find("input[name='password']"),i=d.find("input[name='user_remark']");return $.jBox.show({width:500,title:"编辑会员",content:d,btnOK:{onBtnClick:function(c){$.jBox.close(c);var d=e.val(),j=f.val(),k=g.val(),l=h.val(),m=i.val();$.ajax({url:"/User/edit",type:"post",dataType:"json",data:{user_id:b,name:d,email:j,mobile:k,password:l,user_remark:m},beforeSend:function(){$.jBox.showloading()},success:function(b){1==b.status?(HYD.hint("success","恭喜您，编辑成功！"),a.data("mobile",k),a.data("email",j),a.data("name",d),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，编辑失败："+b.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-cancel").click(function(){var a=$(this),b=a.data("id"),c=(a.data("name"),_.template($("#tpl_jbox_simple").html(),{content:"取消资格后将不可恢复，是否继续？"})),d=$(c);return $.jBox.show({width:300,title:"取消分销商资格",content:d,btnOK:{onBtnClick:function(a){$.jBox.close(a),$.ajax({url:"/User/setAgentCancel",type:"post",dataType:"json",data:{user_id:b},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，取消资格成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-agent").click(function(){var a=$(this),b=a.data("id");defaults={mobile:a.data("mobile"),email:a.data("email"),name:a.data("name")};var c=_.template($("#tpl_user_set_agent").html(),defaults),d=$(c);return $.jBox.show({width:400,title:"设为分销商",content:d,btnOK:{onBtnClick:function(a){$.jBox.close(a),$.ajax({url:"/User/agent",type:"post",dataType:"json",data:{user_id:b},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，编辑成功！"),setTimeout(function(){window.location.reload()},1e3)):2==a.status?HYD.hint("danger",a.msg,5e3):HYD.hint("danger","对不起，编辑失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-setAgent").click(function(){var a=[],b=$(".table-ckbs:checked");if(b.each(function(){a.push($(this).data("id"))}),!a.length)return void HYD.hint("warning","对不起，请选择需要设置的会员！");var c={},d=_.template($("#tpl_user_set_agent").html(),c),e=$(d);return $.jBox.show({title:"批量设置分销商",content:e,btnOK:{onBtnClick:function(b){$.jBox.close(b),$.ajax({url:"/User/betchAgent",type:"post",dataType:"json",data:{ids:a},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，设置成功！"),setTimeout(function(){window.location.reload()},1e3)):2==a.status?HYD.hint("danger",a.msg,5e3):HYD.hint("danger","对不起，编辑失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$("#J_wx_fans").click(function(){$.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"如果您的粉丝很多将会消耗较长时间,是否继续？"}),btnOK:{onBtnClick:function(a){$.jBox.close(a),$.jBox.showloading(),$.post("/PubMarketing/getFans",{p:1},function(a){function b(a){$.post("/PubMarketing/getFans",{p:a},function(a){a.next?b(a.next):c(a)})}function c(a){function b(){setTimeout(function(){$.post("/PubMarketing/getUserInfo",{offect:d},function(e){if(1==e.status){var f=parseInt($(".Progress-bar-success").attr("aria-valuenow"));f+=1;var g=f/c*100+"%";$(".Progress-bar-success").attr("aria-valuenow",f),$(".Progress-bar-success").attr("style","width:"+g),$(".now_num").text(f),$("#span-error-msg").html("成功")}else{var h=parseInt($(".progress-bar-danger").attr("aria-valuenow"));h+=1;var g=h/c*100+"%";$(".progress-bar-danger").attr("aria-valuenow",h),$(".progress-bar-danger").attr("style","width:"+g),$(".error_num").text(h),$("#span-error-msg").html(e.info)}d>=a.info&&(location.href=""),d<a.info&&b()})},10),d++}if($.jBox.hideloading(),1==a.status){$.jBox.show({title:"更新进度",btnOK:{show:!1},btnCancel:{onBtnClick:function(){location.href=""}},content:"<div class='progress'><div class='progress-bar Progress-bar-success' role='progressbar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='0' style='width: 0%;'></div><div class='progress-bar progress-bar-danger' role='progressbar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='0' style='width: 0%;'></div></div><div font-size='14px'>总数：<span class='total_num'>0</span>，成功更新数：<span class='now_num'>0</span>，更新失败数：<span class='error_num'>0</span>。<span id='span-error-msg'></span></div>"}),$(".progress-bar").attr("aria-valuemax",a.info);var c=$(".progress-bar").attr("aria-valuemax"),d=0;$(".total_num").text(c),b()}else HYD.hint("danger",a.info),setTimeout(function(){window.location.href=""},2e3)}a.next?b(a.next):c(a)})}}})}),$(".j-agentLevel").click(function(){var a=$(this),b=a.data("id"),c={rank:a.data("rank"),name:a.data("name")},d=_.template($("#tpl_agent_lists_setlevel").html(),c),e=$(d),f=e.find("select[name='agent_rank_id']");return $.jBox.show({width:500,title:"设置分销商等级",content:e,btnOK:{onBtnClick:function(a){var c=f.val();$.jBox.close(a),$.ajax({url:"/User/setAgentRank",type:"post",dataType:"json",data:{user_id:b,agent_rank_id:c},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，设置成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，设置失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-setAgentLevel").click(function(){var a=[],b=$(".table-ckbs:checked");if(b.each(function(){a.push($(this).data("id"))}),!a.length)return void HYD.hint("warning","对不起，请选择需要设置的分销商！");var c={rank:1},d=_.template($("#tpl_agent_lists_alllevel").html(),c),e=$(d),f=e.find("select[name='agent_rank_id']");return $.jBox.show({title:"批量设置分销商等级",content:e,btnOK:{onBtnClick:function(b){var c=f.val();$.jBox.close(b),$.ajax({url:"/User/betchAgentRank",type:"post",dataType:"json",data:{ids:a,agent_rank_id:c},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，设置成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，设置失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-balance").click(function(){var a=$(this),b=a.data("id"),c=a.data("balance");defaults={name:a.data("name"),balance:c};var d=_.template($("#tpl_user_lists_balance").html(),defaults),e=$(d),f=e.find("input[name='payment']"),g=e.find("textarea[name='balance_remark']");return $.jBox.show({width:500,title:"设置余额",content:e,btnOK:{onBtnClick:function(a){return val_rank=parseFloat(f.val()),val_remark=g.val(),isNaN(val_rank)?void HYD.FormShowError(f,"请输入合法金额"):($.jBox.close(a),void $.ajax({url:"/User/setBalance",type:"post",dataType:"json",data:{user_id:b,payment:val_rank,remark:val_remark},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，设置成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，设置失败："+a.msg),$.jBox.hideloading()}}))}}}),!1}),$(".j-sendLetter").click(function(){var a=$(this),b=a.data("id"),c=$("#tpl_user_send_letter").html(),d=$(c);return $.jBox.show({width:500,title:"发送站内信",content:d,btnOK:{onBtnClick:function(a){$.jBox.close(a);var c=a.find("textarea[name='content']").val();$.ajax({url:"/User/sendUserLetter",type:"post",dataType:"json",data:{user_id:b,content:c},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，发送成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，发送失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-del").click(function(){var a=$(this),b=a.data("id");return $.jBox.show({title:"删除会员",content:"除非必要，请不要随意删除会员，删除了会员后，<br/>此会员将访问不了您的商城！您确定要删除此会员吗？",btnOK:{onBtnClick:function(a){$.jBox.close(a),$.ajax({url:"/User/delUser",type:"post",dataType:"json",data:{id:b},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，删除成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，删除失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".J_preview").click(function(){var a=$(this),b=a.data("id"),c=a.data("user"),d=a.data("type");return $.jBox.show({title:"发送预览",content:"确认发送吗？",btnOK:{onBtnClick:function(a){$.jBox.close(a),$.ajax({url:"/User/preview",type:"post",dataType:"json",data:{id:b,user:c,type:d},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?HYD.hint("success","恭喜，发送预览成功！"):HYD.hint("danger","抱歉，发送预览失败："+a.msg),setTimeout(function(){window.location.href=a.link},1e3)}})}}}),!1}),$(".j-reborn").click(function(){var a=$(this),b=a.data("id");return $.jBox.show({title:"恢复会员",content:"确认恢复吗？",btnOK:{onBtnClick:function(a){$.jBox.close(a),$.ajax({url:"/User/rebornUser",type:"post",dataType:"json",data:{id:b},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，恢复成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，恢复失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-rebornAll").click(function(){var a=[],b=$(".table-ckbs:checked");return b.each(function(){a.push($(this).data("id"))}),a.length?($.jBox.show({title:"批量恢复",content:_.template($("#tpl_user_reborn_user").html()),btnOK:{onBtnClick:function(b){b.find('input[name="password"]').val();$.jBox.close(b),$.ajax({url:"/User/batchReborn",type:"post",dataType:"json",data:{ids:a},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，恢复成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，恢复失败："+a.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择需要设置的会员！")}),$(".j-setGroup").click(function(){var a=[],b=$(".table-ckbs:checked"),c=$(this).data("type");return b.each(function(){a.push($(this).data("id"))}),a.length?($.jBox.show({title:"批量设置分组",content:_.template($("#tpl_user_lists_group").html()),btnOK:{onBtnClick:function(b){var d=b.find('select[name="user_group_id"]').val();$.jBox.close(b),$.ajax({url:"/User/betchSetGroup",type:"post",dataType:"json",data:{ids:a,user_group_id:d,type:c},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，设置成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，设置失败："+a.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择需要设置的会员！")}),$(".j-commission").click(function(){var a=$(this),b=a.data("id"),c=a.data("balance");defaults={name:a.data("name"),commission:c,remark:a.data("remark")};var d=_.template($("#tpl_user_lists_commission").html(),defaults),e=$(d),f=e.find("input[name='payment']");return $remark=e.find("input[name='remark']"),$.jBox.show({width:500,title:"修改佣金",content:e,btnOK:{onBtnClick:function(a){return val_rank=parseFloat(f.val()),val_remark=$remark.val(),isNaN(val_rank)?void HYD.FormShowError(f,"请输入合法金额"+val_remark):($.jBox.close(a),void $.ajax({url:"/User/updateCommission",type:"post",dataType:"json",data:{user_id:b,payment:val_rank,remark:val_remark},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，设置成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，设置失败："+a.msg),$.jBox.hideloading()}}))}}}),!1}),$(".j-sendUmp").click(function(){var a=$(this),b=a.data("id");return $.jBox.show({width:500,title:"送优惠券",content:$("#tpl_user_lists_ump").html(),btnOK:{onBtnClick:function(a){$.jBox.close(a);var c=a.find('select[name="coupon_id"]').val();$.ajax({url:"/User/sendCoupon",type:"post",dataType:"json",data:{user_id:b,coupon_id:c},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，操作成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-setSuperior").click(function(){var a=[],b=$(".table-ckbs:checked");return b.each(function(){a.push($(this).data("id"))}),a.length?void(window.location.href="/User/set_superior/id/"+a):void HYD.hint("warning","对不起，请选择需要设置的会员！")}),$(".j-setPwd").click(function(){var a=[],b=$(".table-ckbs:checked");return b.each(function(){a.push($(this).data("id"))}),a.length?($.jBox.show({title:"批量设置密码",content:_.template($("#tpl_user_lists_pwd").html()),btnOK:{onBtnClick:function(b){var c=b.find('input[name="password"]').val();$.jBox.close(b),$.ajax({url:"/User/batchSetPwd",type:"post",dataType:"json",data:{ids:a,password:c},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，设置成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，设置失败："+a.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择需要设置的会员！")}),$(".j-sendCoupon").click(function(){var a=[],b=$(".table-ckbs:checked");return b.each(function(){a.push($(this).data("id"))}),$.jBox.show({title:"批量发放优惠券",content:_.template($("#tpl_user_lists_ump").html()),btnOK:{onBtnClick:function(b){var c=b.find('select[name="coupon_id"]').val(),d=b.find('select[name="rank_id"]').val();$.jBox.close(b),$.ajax({url:"/User/batchSendCoupon",type:"post",dataType:"json",data:{ids:a,coupon_id:c,rank_id:d},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，发放成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，发放失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-setSinglePwd").click(function(){var a=$(this),b=a.data("id");defaults={};var c=_.template($("#tpl_appUser_editPwd").html(),defaults),d=$(c),e=d.find("input[name='password']");$.jBox.show({width:400,title:"提示",content:d,btnOK:{onBtnClick:function(a){$.jBox.close(a),pwd=e.val(),$.ajax({url:"/Shop/editPwd",type:"post",dataType:"json",data:{user_id:b,password:pwd},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，编辑成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，编辑失败"),$.jBox.hideloading()}})}}})}),$(".j-agent_time").click(function(){var a=$(this),b=a.data("id"),c=a.data("time");"--"==c&&(c=""),defaults={time:c};var d=_.template($("#tpl_agent_time").html(),defaults),e=$(d),f=e.find("input[name='agent_time']");return $.jBox.show({width:400,title:"设为分销商到期时间",content:e,btnOK:{onBtnClick:function(a){$.jBox.close(a),$.ajax({url:"/User/setAgentTime",type:"post",dataType:"json",data:{user_id:b,agent_time:f.val()},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，设置成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，设置失败："+a.msg),$.jBox.hideloading()}})}}}),!1})});