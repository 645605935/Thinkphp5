$(function(){$(".J-letter").click(function(){return $.jBox.show({width:600,height:600,title:"添加站内信",content:_.template($("#tpl_letter").html()),btnOK:{onBtnClick:function(a){$.jBox.close(a);var b=a.find(".user_select").val(),c=a.find(".agent_select").val(),d=a.find(".send_select").val(),e=a.find("textarea[name='content']").val();$.ajax({url:"/User/addLetter",type:"post",dataType:"json",data:{rank_id:b,agent_rank_id:c,type:d,content:e},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，添加成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，添加失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".J-edit").click(function(){var a=$(this),b=a.data("id");defaults={type:a.data("type"),rank:a.data("rank"),agent:a.data("agent"),content:a.data("content")};var c=_.template($("#tpl_edit_letter").html(),defaults),d=$(c),e=d.find(".user_select"),f=d.find(".agent_select"),g=d.find("textarea[name='content']");return $.jBox.show({width:600,height:600,title:"编辑站内信",content:d,btnOK:{onBtnClick:function(c){$.jBox.close(c);var d=c.find(".send_select").val(),h=e.val(),i=f.val(),j=g.val();$.ajax({url:"/User/editLetter",type:"post",dataType:"json",data:{message_id:b,type:d,rank_id:h,content:j,agent_rank_id:i},beforeSend:function(){$.jBox.showloading()},success:function(b){1==b.status?(HYD.hint("success","恭喜您，编辑成功！"),a.data("content",j),a.data("rank",h),a.data("type",d),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，编辑失败："+b.msg),$.jBox.hideloading()}})}}}),!1}),$(".J-del").click(function(){var a=$(this),b=a.data("id");return $.jBox.show({width:300,title:"删除站内信",content:"确认要删除此信息吗？",btnOK:{onBtnClick:function(a){$.jBox.close(a),$.ajax({url:"/User/delLetter",type:"post",dataType:"json",data:{id:b},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，删除成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，删除失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".J-send").click(function(){var a=$(this),b=a.data("id");return $.jBox.show({width:300,title:"发送站内信",content:"确认要发送此信息吗？",btnOK:{onBtnClick:function(a){$.jBox.close(a),$.ajax({url:"/User/sendLetter",type:"post",dataType:"json",data:{id:b},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，发送成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，发送失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-delAll").click(function(){var a=[],b=$(".table-ckbs:checked");return b.each(function(){a.push($(this).data("id"))}),a.length?($.jBox.show({title:"批量删除站内信",content:"确认要删除选中的站内信息吗？",btnOK:{onBtnClick:function(b){$.jBox.close(b),$.ajax({url:"/User/delAllLetter",type:"post",dataType:"json",data:{ids:a},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，删除成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，删除失败："+a.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择需要删除的站内信息！")}),$(".J-detail").click(function(){var a=$(this);a.data("id");defaults={type:a.data("type"),rank:a.data("rank"),agent:a.data("agent"),content:a.data("content")};var b=_.template($("#tpl_detail_letter").html(),defaults),c=$(b);c.find(".user_select"),c.find(".agent_select"),c.find("textarea[name='content']");return $.jBox.show({width:600,height:600,title:"站内信详情",content:c,btnOK:{onBtnClick:function(a){$.jBox.close(a)}}}),!1})});