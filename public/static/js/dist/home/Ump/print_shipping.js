function printKd(){var a=$("#order_id").val();printit("order_id="+a,"selected")}function printAll(a){var b=$("#search_form").serialize();a=void 0!=a?a:1,b+="&start="+a,printit(b,"all")}function printSelected(){var a=[],b=$(".table-ckbs:checked");if(b.each(function(){a.push($(this).data("id"))}),!a.length)return void HYD.hint("warning","对不起，请选择要打印的订单！");var c=$("#tpl_order_lists_print").html(),d=$(c);return $.jBox.show({title:"提示",content:d,btnOK:{onBtnClick:function(b){var c=d.find("select[name='print_tpl']").val();$.jBox.close(b),printit(a,"selected",c)}}}),!1}function printit(a,b,c){$.ajax({url:"/Order/batch_shipping_print",type:"post",data:{ids:a,type:"point_selected",print_tpl_id:c},dataType:"json",beforeSend:function(){$.jBox.showloading()},success:function(a){if(0==a.status)return HYD.hint("danger","对不起，打印失败："+a.msg),$.jBox.hideloading(),!1;if(LODOP=getLodop(document.getElementById("LODOP_OB"),document.getElementById("LODOP_EM")),!LODOP.PRINT_INIT("【"+a.other.MB_NAME+"】快递单批量打印"))return HYD.hint("danger","请连接打印机！"),$.jBox.hideloading(),!1;LODOP.ADD_PRINT_SETUP_BKIMG('<img src="'+a.other.MB_BG+'" />'),LODOP.SET_SHOW_MODE("BKIMG_IN_PREVIEW",1),LODOP.SET_PRINT_PAGESIZE(1,a.other.MB_WIDTH,a.other.MB_HEIGHT,"");var c="";for(var d in a.page){LODOP.NewPage();for(var e in a.page[d].item)c="item_"+e,""!=a.page[d].item[e].S?LODOP.SET_PRINT_STYLE("FontSize",a.page[d].item[e].S):LODOP.SET_PRINT_STYLE("FontSize",9),""!=a.page[d].item[e].B?LODOP.SET_PRINT_STYLE("Bold",a.page[d].item[e].B):LODOP.SET_PRINT_STYLE("Bold",0),""!=a.page[d].item[e].I?LODOP.SET_PRINT_STYLE("Italic",a.page[d].item[e].I):LODOP.SET_PRINT_STYLE("Italic",0),""!=a.page[d].item[e].L?LODOP.SET_PRINT_STYLEA(c,"LetterSpacing",a.page[d].item[e].L):LODOP.SET_PRINT_STYLEA(c,"LetterSpacing",0),LODOP.ADD_PRINT_TEXTA(c,a.page[d].item[e].Y,a.page[d].item[e].X,a.page[d].item[e].W,a.page[d].item[e].H,a.page[d].item[e].VALUE)}return LODOP.SET_PRINT_MODE("POS_BASEON_PAPER",!0),-1==LODOP.SELECT_PRINTER()?(HYD.hint("danger","打印已取消！"),$.jBox.hideloading(),!1):(tip||(HYD.hint("danger","请确保打印纸的类型为【"+a.other.MB_NAME+"】的快递单！"),$.jBox.hideloading(),tip=!0),printStatus=LODOP.PRINT(),printStatus?"all"!=b||a.other.IS_FINISH?(HYD.hint("success","恭喜，打印完毕！"),$.jBox.hideloading(),void(tip=!1)):(showPopTip({tip:">>>下一页>>>",timing:2e3}),printAll(a.other.START),!0):!1)}})}var LODOP,tip=!1;$(function(){$(".J_print_delivery").click(function(){$("table :checkbox").prop("checked",!1).length,$(this).closest("td").find(":checkbox").prop("checked",!0),$("#print_selected").click()}),$("#print_selected").on("click",printSelected),$("#print_kd").on("click",printKd)});