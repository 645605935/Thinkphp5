HYD.game={},HYD.game.data={type:$("#j-gametype").val(),starttime:$("input[name='starttime']").val(),endtime:$("input[name='endtime']").val(),description:$("textarea[name='description']").val(),prizepoints:[$("input[name='prize_type[1]']").val(),$("input[name='prize_type[2]']").val(),$("input[name='prize_type[3]']").val(),$("input[name='prize_type[4]']").val()]},HYD.game.reRenderGame=function(){HYD.game.data.starttime=$("input[name='starttime']").val(),HYD.game.data.endtime=$("input[name='endtime']").val();var a=_.template($("#tpl_edit_game"+HYD.game.data.type).html(),HYD.game.data);$(".diy-phone-contain").empty().append(a)},HYD.game.WdateChange=function(){HYD.FormClearError($(this)),HYD.game.reRenderGame()},$(function(){var a="#editGameCgTabs",b=function(){$(".j-copy").zclip({path:"/Public/plugins/zclip/ZeroClipboard.swf",copy:function(){return $(this).data("copy")},afterCopy:function(){HYD.hint("success","内容已成功复制到您的剪贴板中")}})},c=function(){var a=$("input[name='title']"),b=$("input[name='starttime']"),c=$("input[name='endtime']"),d=a.val(),e=b.val(),f=c.val();return""==d?(HYD.FormShowError(a,"请输入活动名称"),!1):""==e?(HYD.FormShowError(b,"请选择开始时间"),!1):""==f?(HYD.FormShowError(c,"请选择结束时间"),!1):!0},d=function(){var a=$("input[name='costpoint']"),b=a.val();return""==b?(HYD.FormShowError(a,"请输入消耗积分，值为0时不消耗"),!1):HYD.regRules.integer.test(b)?!0:(HYD.FormShowError(a,"请输入一个正整数"),!1)},e=function(){var a=!0,b=0;$(".j-stepVerify[name^='prizepoints']").each(function(){var b=$(this),c=b.val();return""==c?(HYD.FormShowError(b,"请输入赠送积分"),a=!1,!1):HYD.regRules.integer.test(c)?void 0:(HYD.FormShowError(b,"请输入一个正整数"),a=!1,!1)}),$(".j-stepVerify[name^='prizenum']").each(function(){var b=$(this),c=b.val();return""==c?(HYD.FormShowError(b,"请输入奖品数量"),a=!1,!1):HYD.regRules.integer.test(c)?void 0:(HYD.FormShowError(b,"请输入一个正整数"),a=!1,!1)}),$(".j-stepVerify[name^='probability']").each(function(){var c=$(this),d=c.val();return""==d?(HYD.FormShowError(c,"请输入中奖率"),a=!1,!1):HYD.regRules.integer.test(d)?void(b+=parseInt(d)):(HYD.FormShowError(c,"请输入一个正整数"),a=!1,!1)});var c=$("textarea[name='failtext']"),d=c.val();return""==d?(HYD.FormShowError(c,"请输入未中奖说明"),!1):(b>=100&&(HYD.FormShowError($(".j-stepVerify[name^='probability']"),"中奖率总和必须小于100"),a=!1),a)};$(".j-diyNextBtn").click(function(){var f=$(this).parent(".btn-step").data("step"),g=parseInt(f)+1,h=!1;switch(f){case 0:h=c();break;case 1:h=d();break;case 2:h=e()}if(h){var i=$(".btn-step,.diy-ctrl-item");i.filter("[data-step='"+f+"']").hide(),i.filter("[data-step='"+g+"']").show(),HYD.changeWizardStep(a,g),3==g&&b()}}),$(".j-diyPrevBtn").click(function(){var b=$(this).parent(".btn-step").data("step"),c=parseInt(b)-1,d=$(".btn-step,.diy-ctrl-item");d.filter("[data-step='"+b+"']").hide(),d.filter("[data-step='"+c+"']").show(),HYD.changeWizardStep(a,c)}),$("#gameform").submit(function(){var a=e();return a}),$(".j-render").change(function(){var a=$(this).val(),b=$(this).attr("name");HYD.game.data[b]=a,HYD.game.reRenderGame()}),$(".j-prize-render").change(function(){var a=$(this).val(),b=$(this).data("index")-1;HYD.game.data.prizepoints[b]=a,HYD.game.reRenderGame()}),HYD.game.reRenderGame();var f=$(".coupon").val();f=$.parseJSON(f),$(document).on("change",'.spoilstyle input[type="radio"]',function(a){var b,c=$(this),d=c.closest(".spoils-item"),e=d.data("index"),g=d.children('input[name="goods_item"]'),h=g.data("points"),i=g.data("coupon");if(2==c.val()){var j=g.val(),k=g.data("compress"),l=g.data("pic");b={is_compress:k,item_id:j,pic:l=l?l:"/Public/images/diy/waitupload3.png"}}else b=null;var m=c.val(),n=function(a){var b;return 0==a&&(b="一等奖："),1==a&&(b="二等奖："),2==a&&(b="三等奖："),3==a&&(b="普通奖："),b};if(0==m){var o=n(e-1);$("#main").children(".roll_top").find("li").eq(e-1).html(o+"赠送积分")}if(1==m){var o=n(e-1);$("#main").children(".roll_top").find("li").eq(e-1).html(o+"赠送优惠券")}if(2==m){var o=n(e-1);$("#main").children(".roll_top").find("li").eq(e-1).html(o+"赠送产品")}var p=$("#tpl_spoils").html(),q=_.template(p,{spoilstyle:m,coupon:f,goodsitem:b,index:e,current_coupon:i,points:h});d.find(".j-getspoils").empty().append(q),d.find(".j-addspoils").click(function(a){var b=$(this);HYD.popbox.dplPickerColletion({linkType:1,callback:function(a,c){var d=1==a.is_compress?a.pic+"80x80":a.pic;b.children("img").attr("src",d),b.children(":hidden").val(a.item_id)}})})}),$(".spoils-item").each(function(a,b){var c=$(this),d=c.find("input:checked").val();2==d&&c.find(".j-addspoils").click(function(a){var b=$(this);HYD.popbox.dplPickerColletion({linkType:1,callback:function(a,c){var d=1==a.is_compress?a.pic+"80x80":a.pic;b.children("img").attr("src",d),b.children(":hidden").val(a.item_id)}})})})});