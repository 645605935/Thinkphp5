$(function(){HYD.ItemAdd=HYD.ItemAdd?HYD.ItemAdd:{},$("#supplierclass1").change(function(){var a=$(this).val();$.post("/Item/getSupplierClass",{id:a},function(a){if(1==a.status){var b=$("#supplierclass2");$("option",b).remove(),$.each(a.data,function(a,c){var d="<option value='"+c.supplier_class_id+"'>"+c.class_name+"</option>";b.append(d)})}})});var a=$(".j-buyway:checked").val(),b=$("#j-isSid").val(),c=$("#j-hasNorms").val(),d=function(){1==b&&1==c?$(".j-emptyhide").show():1==b&&0==c&&$(".j-emptyhide").hide()},e=function(a){1==a?($(".j-showinhyd").show(),$(".j-emptyhide").show(),$(".wb_buy").hide(),d(),$("#j-totalStock").attr("disabled",$("#j-skuVal").val().length>2?!0:!1)):2==a&&($(".j-showinhyd").hide(),$(".j-emptyhide").hide(),$(".wb_buy").show(),$("#j-totalStock").attr("disabled",!1))};$(".j-buyway").change(function(){e($(this).val())}),d(),e(a),HYD.ItemAdd.goodsGroupLabel=[],_.each($(".j-goodsGroupLabel"),function(a,b){var c=$(a);HYD.ItemAdd.goodsGroupLabel.push({dom_item:c,id:c.data("id"),title:c.data("title"),isCheck:c.is(":checked")})});var f=function(){var a=_.template($("#tpl_add_step2_goodsGroupLabelList_item").html(),{dataset:HYD.ItemAdd.goodsGroupLabel});$(".j-goodsGroupLabelList").remove(),$(a).insertBefore(".droplist-goodsGroupLabelList")};$(".j-goodsGroupLabel").change(function(){var a=$(this).parent("label").index();HYD.ItemAdd.goodsGroupLabel[a].isCheck=$(this).is(":checked"),f()}),$(document).on("click",".j-goodsGroupLabelList .j-del",function(){var a=$(this).data("id");_.each(HYD.ItemAdd.goodsGroupLabel,function(b,c){return b.id==a?(b.isCheck=!1,b.dom_item.attr("checked",!1),!1):void 0}),f()}),HYD.ItemAdd.imglist=[];var g=function(){var a=$("#tpl_add_step2_imgList").html(),b=_.template(a,{dataset:HYD.ItemAdd.imglist,str_dataset:HYD.ItemAdd.imglist.join(",")});$(".j-imglistPanel").empty().append(b)},h=$(".j-imglist-dataset").val();h.length&&(HYD.ItemAdd.imglist=h.split(","),g()),$(document).on("click",".j-addimg",function(){HYD.popbox.ImgPicker(function(a){_.each(a,function(a){HYD.ItemAdd.imglist.push(a)}),g()})}),$(document).on("click",".j-delimg",function(){var a=$(this).parent("li").data("index");HYD.ItemAdd.imglist.splice(a,1),g()}),$(".j-feight").change(function(){var a=$(".j-feight-ipt"),b=$("#freight_tpl_id");switch($(this).val()){case"1":a.attr("disabled",!0),b.attr("disabled",!0);break;case"2":a.attr("disabled",!1),b.attr("disabled",!0);break;case"3":a.attr("disabled",!0),b.attr("disabled",!1)}}),$("#add_step2").submit(function(){var a=$("input[name=title]").val();if(!a)return HYD.hint("danger","对不起，产品标题不能为空！"),$("input[name=title]").focus(),!1;var b=$("#supplier").val(),c=$("#supplierclass2").val();if(b&&0>=c)return HYD.hint("danger","对不起，供应商分类不能为空！"),$("input[name=title]").focus(),!1;var d=$("input[name=original_price]").val();if("0.00"==d||!d)return HYD.hint("danger","对不起，请填写产品原价！"),$("input[name=original_price]").focus(),!1;var e=$("input[name=price]").val();if(""==e)return HYD.hint("danger","对不起，请填写产品现价！"),$("input[name=price]").focus(),!1;var f=$("input[name=num]").val();if(!f)return HYD.hint("danger","对不起，请填写产品库存！"),$("input[name=num]").focus(),!1;var g=$("input[name=buy_url]").val(),h=$(".j-buyway:checked").val();if(2==h){var i=/^([a-zA-Z]+:\/\/)*(\w+)\.(\w+(\.\w+))*(\/\w+)*(\/\w+[(\.\w+)|(\/\w+)])(\?\S*)*(\S*)$/;if(!g||!i.test(g))return HYD.hint("danger","对不起，请填写正确的外部购买地址！"),$("input[name=buy_url]").focus(),!1}var j=$(":radio[name='freight_payer']:checked").val();$("#freight_tpl_id").val();return 3!=j||$("#freight_tpl_id").val()?void 0:(HYD.hint("danger","对不起，请选择运费模板！"),$("#freight_tpl_id").focus(),!1)});var i=$(".is_free_logistics:checked").val(),j=function(a){1==a?($(".show").hide(),$(".user_show").show()):($(".show").show(),$(".user_show").hide())};j(i),$(".is_free_logistics").change(function(){var a=$(this).val();j(a)}),$("#j-select_category_id").click(function(){var a=$("#tpl_item_class").html();$.jBox.show({title:"请选择分类",content:a,btnOK:{onBtnClick:function(a){$.jBox.close(a);var b=a.find("select[name=class_id]").val();$.ajax({url:"/Item/selectClass",type:"post",dataType:"json",data:{class_id:b},beforeSend:function(){$.jBox.showloading()},success:function(a){$("#category_text").val(a.class_name),$('input[name="class_id"]').val(a.class_id),$.jBox.hideloading()}})}}})})});