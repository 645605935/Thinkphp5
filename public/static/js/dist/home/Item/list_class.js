$(function(){$(document).on("click",".j-qrcode",function(a){var b=$(this).data("url");HYD.showQrcode("/Public/qrcode?link="+b)}),$(".BtnAddClass").click(function(){$.jBox.show({title:"添加分类",content:_.template($("#tpl_add_class").html()),btnOK:{onBtnClick:function(a){var b=a.find("input[name='title']"),c=$.trim(b.val()),d=a.find("select[name='pid']").val(),e=a.find("input[name='file_path']").val(),f=a.find("input[name='serial']").val(),g=a.find("input[name='link']").val();return""==c?(HYD.FormShowError(b,"分类名称不能为空"),!1):($.jBox.close(a),void $.ajax({url:"/Item/ajaxAddClass",type:"post",dataType:"json",beforeSend:function(){$.jBox.showloading()},data:{class_name:c,parent_id:d,class_img:e,serial:f,link:g},success:function(a){1==a.status?(HYD.hint("success","恭喜，操作成功"+a.msg),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败"+a.msg),$.jBox.hideloading()}}))}}})}),$(document).on("click",".j-editClass",function(a){var b=$(this),c=b.data("id"),d={title:b.data("title"),pid:b.data("pid"),img:b.data("img"),serial:b.data("serial"),link:b.data("link")},e=_.template($("#tpl_edit_class").html(),d),f=$(e);$.jBox.show({title:"编辑分类",content:f,btnOK:{onBtnClick:function(a){var b=a.find("input[name='title']"),d=$.trim(b.val()),e=a.find("select[name='pid']").val(),f=a.find("input[name='file_path']").val(),g=a.find("input[name='serial']").val(),h=a.find("input[name='link']").val();return""==d?(HYD.FormShowError(b,"类目名称不能为空"),!1):($.jBox.close(a),void $.ajax({url:"/Item/ajaxEditClass",type:"post",dataType:"json",beforeSend:function(){$.jBox.showloading()},data:{class_name:d,parent_id:e,class_id:c,class_img:f,serial:g,link:h},success:function(a){1==a.status?(HYD.hint("success","恭喜，操作成功"+a.msg),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败"+a.msg),$.jBox.hideloading()}}))}}})}),$(document).on("click",".j-delClass",function(a){var b=$(this),c=b.data("id");return $.jBox.show({title:"删除分类",content:"删除分类会一起删除类目下的子分类，确认删除吗？",btnOK:{onBtnClick:function(a){$.jBox.close(a),$.ajax({url:"/Item/ajaxDelClass",type:"post",dataType:"json",data:{id:c},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，删除成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，删除失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-able").click(function(){var a=$(this).data("able"),b=$(this).data("id");if("disable"==a)var c="启用";else var c="禁用";$.jBox.show({title:c+"分类",content:"确认要"+c+"吗？",btnOK:{onBtnClick:function(c){$.jBox.close(c),$.ajax({url:"/Item/ajaxAbleClass",type:"post",dataType:"json",data:{id:b,able:a},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，操作成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+a.msg),$.jBox.hideloading()}})}}})}),$(".btn_table_delAll").click(function(){var a=[],b=$(".table-ckbs:checked");return b.each(function(){a.push($(this).data("id"))}),a.length?($.jBox.show({title:"批量删除分类",content:"删除分类会一起删除分类下的子分类，确认删除吗？",btnOK:{onBtnClick:function(b){$.jBox.close(b),$.ajax({url:"/Item/DelAllClass",type:"post",dataType:"json",data:{ids:a},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，删除成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，删除失败："+a.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择需要删除的分类！")}),$(document).on("click",".img-list-add",function(){HYD.popbox.ImgPicker(function(a){var b='<li><span class="img-list-btndel j-delimg"><i class="gicon-trash white"></i></span><span class="img-list-overlay"></span><img src="'+a[0]+'"></li>';$(".img-list").empty().append(b),$(".j-imglist-dataset").val(a[0])})}),$(document).on("click",".j-delimg",function(){var a='<li class="img-list-add">+</li>';$(".img-list").empty().append(a),$(".j-imglist-dataset").val("")})});