$(function(){var a={1:{page:{title:"商城导航"},PModules:[{id:1,type:"Navigation",draggable:!1,sort:0,content:{showInhome:!0,showInuser:!0,showIncustom:!0,showIngoodslist:!0,curMainindex:-1,curSubindex:-1,style:0,dataset:[{linkType:6,link:"#",title:"商城主页",showtitle:"商城主页",icon:"/PublicMob/images/icon/style1/color0/icon_home.png",bgColor:"#fff",fotColor:"#333",subNav:[]},{linkType:7,link:"#",title:"会员主页",showtitle:"会员主页",icon:"/PublicMob/images/icon/style1/color0/icon_user.png",bgColor:"#fff",fotColor:"#333",subNav:[]},{linkType:8,link:"/Item/lists",title:"",showtitle:"所有产品",icon:"/PublicMob/images/icon/style1/color0/icon_allgoods.png",bgColor:"#fff",fotColor:"#333",subNav:[]},{linkType:9,link:"#",title:"",showtitle:"申请分销",icon:"/PublicMob/images/icon/style1/color0/icon_fx.png",bgColor:"#fff",fotColor:"#333",subNav:[]}]},dom_conitem:null,ue:null}],LModules:[]}};HYD.DIY.Unit.event_typeNavigation=function(a,b){var c=b.dom_conitem,d=a,e=$("#tpl_diy_con_typeNavigation").html(),f=$("#tpl_diy_ctrl_typeNavigation").html(),g=($("#tpl_diy_ctrl_typeNavigation_detail").html(),function(){var a=$(_.template(e,b));c.find(".navPanel").remove().end().append(a),console.log(b);var g=$(_.template(f,b));d.empty().append(g),HYD.DIY.Unit.event_typeNavigation(d,b)});d.find("input[name='showtitle']").focus(),d.find("input[name='showInhome'],input[name='showInuser'],input[name='showIncustom'],input[name='showIngoodslist']").change(function(){var a=$(this).attr("name"),c=$(this).is(":checked");b.content[a]=c}),d.find(".np-left-navlist dt").click(function(){var a=$(this).parents("li").index()-1;return b.content.curMainindex=a,b.content.curSubindex=-1,g(),!1}),d.find(".np-left-navlist dd").click(function(){var a=$(this).siblings("dt").parents("li").index()-1;return index2=$(this).index()-1,b.content.curMainindex=a,b.content.curSubindex=index2,g(),!1}),d.find(".droplist li").click(function(){var a=b.content.curMainindex,c=b.content.curSubindex,d=null;b.content.curMainindex>=0&&b.content.curSubindex<0?d=b.content.dataset[a]:b.content.curMainindex>=0&&b.content.curSubindex>=0&&(d=b.content.dataset[a].subNav[c]),HYD.popbox.dplPickerColletion({linkType:$(this).data("val"),callback:function(a,b){d.title=a.title,d.showtitle=a.title,d.link=a.link,d.linkType=b,g()}})}),d.find("input[name='showtitle']").change(function(){var a=b.content.curMainindex,c=b.content.curSubindex,d=null,e=b.content.curMainindex>=0&&b.content.curSubindex<0,f=b.content.curMainindex>=0&&b.content.curSubindex>=0,h=$(this).val();e?d=b.content.dataset[a]:f&&(d=b.content.dataset[a].subNav[c]);var i=e?4:6,j=/\W/g;j.test(h)?h.length>i&&(h=h.substring(0,i),$(this).val(h)):h.length>i&&(h=h.substring(0,2*i),$(this).val(h)),d.showtitle=h,g()}),d.find(".j-uploadIcon").click(function(a){var c=$(this).closest(".navCtrlPanel-right").siblings("ul").find("li").find("dt.selected").closest("li").index()-1;HYD.popbox.ImgPicker(function(a){b.content.dataset[c].icon=a[0],g()})}),d.find(".j-navModifyIcon").click(function(){var a=$(this).closest(".navCtrlPanel-right").siblings("ul").find("li").find("dt.selected").closest("li").index()-1;HYD.popbox.IconPicker(function(c){b.content.dataset[a].icon=c[0],g()})}),d.find(".colorPicker").each(function(a){var c=($(this).data("name"),$(this).data("color")),d=$(this);0==a?d.ColorPicker({color:c,onShow:function(a){return $(a).fadeIn(500),!1},onHide:function(a){return $(a).fadeOut(500),g(),!1},onChange:function(a,c,e){var c="#"+c,f=d.closest(".navCtrlPanel-right").siblings("ul").find("li").find("dt.selected").closest("li").index()-1;b.content.dataset[f].bgColor=c,console.log(f),d.css("background-color",c)}}):d.ColorPicker({color:c,onShow:function(a){return $(a).fadeIn(500),!1},onHide:function(a){return $(a).fadeOut(500),g(),!1},onChange:function(a,c,e){var c="#"+c,f=d.closest(".navCtrlPanel-right").siblings("ul").find("li").find("dt.selected").closest("li").index()-1;b.content.dataset[f].fotColor=c,console.log(f),d.css("background-color",c)}})}),d.find('input[name="showstyle"]').change(function(a){var c=$(this).val();b.content.style=c,g()}),d.find("input[name='customlink']").change(function(){var a=b.content.curMainindex,c=b.content.curSubindex,d=null;b.content.curMainindex>=0&&b.content.curSubindex<0?d=b.content.dataset[a]:b.content.curMainindex>=0&&b.content.curSubindex>=0&&(d=b.content.dataset[a].subNav[c]),d.link=$(this).val(),g()}),d.find(".j-addNav").click(function(){var a={linkType:0,link:"",title:"导航名称",showtitle:"导航名称",subNav:[]};return b.content.dataset.length>=4?void HYD.hint("warning","最多可以添加4个一级导航菜单"):(b.content.dataset.push(a),b.content.curMainindex=b.content.dataset.length-1,b.content.curSubindex=-1,g(),!1)}),d.find(".j-addSubNav").click(function(){var a={linkType:0,link:"",title:"导航名称",showtitle:"导航名称"},c=$(this).parents("li").index()-1;return b.content.dataset[c].subNav.length>=10?void HYD.hint("warning","最多可以添加10个二级导航菜单"):(b.content.dataset[c].subNav.push(a),b.content.curMainindex=c,b.content.curSubindex=b.content.dataset[c].subNav.length-1,g(),!1)}),d.find(".j-delNav").click(function(){var a=$(this).parents("li").index()-1;return b.content.dataset.splice(a,1),b.content.curMainindex=-1,b.content.curSubindex=-1,g(),!1}),d.find(".j-delSubNav").click(function(){var a=$(this).parents("li").index()-1,c=$(this).parents("dd").index()-1;return b.content.dataset[a].subNav.splice(c,1),b.content.curMainindex=-1,b.content.curSubindex=-1,g(),!1})};var b=$("#j-initdata").val(),c=$("#j-pageID").val();b=b.length?$.parseJSON(b):a[c],$(".j-pagetitle").text(b.page.title),$(".j-pagetitle-ipt").val(b.page.title),_.each(b.PModules,function(a,b){var c=0==b?!0:!1;HYD.DIY.add(a,c)}),_.each(b.LModules,function(a){HYD.DIY.add(a)}),$(document).on("click",".j-showNavSub dt",function(){return $(".nav-item-sub").hide(),$(this).siblings(".nav-item-sub").show(),!1}),$("#j-savePage").click(function(){if(HYD.DIY.Unit.verify()){var a=HYD.DIY.Unit.getData();return a.PModules[0].content.curMainindex=-1,a.PModules[0].content.curMainindex=-1,$.ajax({url:window.location.href,type:"post",dataType:"json",data:{content:JSON.stringify(a),is_preview:0},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?HYD.hint("success","恭喜您，保存成功！"):HYD.hint("danger","对不起，保存失败："+a.msg),$.jBox.hideloading()}}),!1}})});