$(function(){$(".send_deliver").change(function(){var a=$(this).val();10==a?($(".express_class").removeClass("hide"),$(".express_class").addClass("inline-block")):($(".express_class").removeClass("inline-block"),$(".express_class").addClass("hide"))});var a=$("input[name='is_self_take']:checked").val();change_deliver(a),$('input[name="is_self_take"]').change(function(){change_deliver($(this).val())}),$("#j-order-deliver").click(function(){var a=$(this).data("id"),b=$('select[name="self_address_id"]').val(),c=$("select[name='express']").val(),d=$("input[name='express_no']").val(),e=$("input[name='express_name']").val(),f=$("input[name='is_self_take']:checked").val();if(0==f){if(0==c)return void HYD.hint("danger","对不起，请选择快递方式！");if(""==d)return void HYD.hint("danger","对不起，快递编号不能为空！")}else{if(0>b)return void HYD.hint("danger","请选择自提地址！");if(0==b){var g=$("input[name='name']"),h=$("input[name='mobile']"),i=$("input[name='phone']"),j=$("input[name='shop_name']"),k=$("select[name='province_id']"),l=$("select[name='city_id']"),m=$("select[name='area_id']"),n=$("textarea[name='address']"),o=g.val(),p=h.val(),q=k.val(),r=l.val(),s=m.val(),t=i.val(),u=j.val(),v=n.val();if(""==o)return void HYD.hint("danger","联系人姓名不能为空");if(""==p)return void HYD.hint("danger","手机号不能为空");if(0==q)return void HYD.hint("danger","请选择省份");if(0==r)return void HYD.hint("danger","请选择城市");if(0==s)return void HYD.hint("danger","请选择地区");if(""==v)return void HYD.hint("danger","请填写详细地址")}}return $.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"确认发货吗？"}),btnOK:{onBtnClick:function(g){$.jBox.close(g),$.ajax({url:"/Order/ajax_send_goods",type:"post",dataType:"json",data:{id:a,express:c,express_name:e,express_no:d,is_self_take:f,self_address_id:b,name:o,mobile:p,province_id:q,city_id:r,area_id:s,address:v,phone:t,shop_name:u},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，操作成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$("#j-no-deliver").click(function(){var a=$(this).data("id");$.jBox.show({width:500,title:"标记发货",content:_.template($("#tpl_jbox_simple").html(),{content:"确认发货吗？"}),btnOK:{onBtnClick:function(b){$.jBox.close(b),$.ajax({url:"/Order/ajax_send_order",type:"post",dataType:"json",data:{id:a},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，标记发货成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，标记发货失败："+a.msg),$.jBox.hideloading()}})}}})}),$("#j-order-close").click(function(){var a=$(this).data("id");return $.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"关闭后将不可恢复，是否继续？"}),btnOK:{onBtnClick:function(b){$.jBox.close(b),$.ajax({url:"/Order/cancle_order",type:"post",dataType:"json",data:{id:a,action:"cancle"},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，订单已关闭！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，订单关闭失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$("#j-order-modify").click(function(){var a=$(this).data("id");$.post("/Order/ajax_order_list",{order_id:a},function(a){var a=a.data,b=_.template($("#tpl_order_lists_modify").html(),a),c=$(b),d=function(){a.riseOrDrop=parseFloat(c.find(".j-modify-riseOrDrop").val());var b=c.find(".j-modify-freightipt"),d=c.find(".j-modify-ptout-freight");0==c.find(".j-modify-freight:checked").val()?(a.freight=0,d.text("包邮"),b.attr("disabled",!0)):(a.freight=parseFloat(b.val()),d.text("(包含"+a.freight+"元邮费)"),b.attr("disabled",!1)),a.realPrice=a.orderPrice-a.coupon.money+a.riseOrDrop+a.freight,c.find(".j-modify-ptout-realPrice").text(a.realPrice.toFixed(2))};c.find(".j-modify-riseOrDrop,.j-modify-freight,.j-modify-freightipt").change(d),$.jBox.show({width:600,title:"修改订单价格",content:c,btnOK:{onBtnClick:function(b){$.jBox.close(b),$.ajax({url:"/Order/cancle_order",type:"post",dataType:"json",data:{data:a,action:"save"},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，订单价格修改成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，订单价格修改失败："+a.msg),$.jBox.hideloading()}})}}})})}),$("#j-feedback-mdf").click(function(){$(".feedback-modifyPanel").show(),$(".feedback-txt").hide()}),$("#j-feedback-mdf-save").click(function(){var a=$(".feedback-modifyPanel textarea").val(),b=$(this).data("id");$.ajax({url:"/Order/ajax_message",type:"post",dataType:"json",data:{id:b,message:a},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，修改成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，修改失败："+a.msg),$.jBox.hideloading()}})}),$("#j-seller-ramrk").click(function(){$(".j-seller-remarkPanel").show(),$(".seller_remark").hide()}),$("#j-seller-remark-save").click(function(){var a=$(".j-seller-remarkPanel textarea").val(),b=$(this).data("id");$.ajax({url:"/Order/ajax_seller_remark",type:"post",dataType:"json",data:{id:b,message:a},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，设置成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，设置失败："+a.msg),$.jBox.hideloading()}})}),$("#j-save_no").click(function(){var a=$(this).data("id"),b=$(".save_express").val(),c=$(".exp_no").val(),d=$(".exp_name").val();return 0==b?void HYD.hint("danger","对不起，请选择快递方式！"):""==c?void HYD.hint("danger","对不起，快递编号不能为空！"):void $.ajax({url:"/Order/ajaxSaveExpressno",type:"post",dataType:"json",data:{id:a,express:b,express_no:c,express_name:d},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，修改成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，修改失败："+a.msg),$.jBox.hideloading()}})}),$("#j-feedback-mdf-cancel").click(function(){$(".feedback-modifyPanel").hide(),$(".feedback-txt").show()}),$("#j-seller-remark-cancel").click(function(){$(".j-seller-remarkPanel").hide(),$(".seller_remark").show()})});var change_deliver=function(a){if(1==a)$(".J_express_company").addClass("hide"),$(".express_class").addClass("hide"),$(".J_express_no").addClass("hide"),$(".J_select_address").removeClass("hide"),$("select[name='self_address_id']").change(function(){0==$(this).val()&&($(".J-name").removeClass("hide"),$(".J-mobile").removeClass("hide"),$(".J-province").removeClass("hide"),$(".J-city").removeClass("hide"),$(".J-area").removeClass("hide"),$(".J-address").removeClass("hide"),$(".s_province").change(function(){var a=$(".s_province").val(),b='<option value="0">请选择</option>';pickerCity(a,function(a){$.each(a,function(a,c){b+="<option value='"+c.city_id+"'>"+c.city_name+"</option>"}),$(".s_city").empty().append(b)})}),$(".s_city").change(function(){var a=$(".s_city").val(),b='<option value="0">请选择</option>';pickerArea(a,function(a){$.each(a,function(a,c){b+="<option value='"+c.area_id+"'>"+c.area_name+"</option>"}),$(".s_area").empty().append(b)})}))});else{$(".J_express_company").removeClass("hide"),$(".J_express_no").removeClass("hide"),$(".J_select_address").addClass("hide"),$(".J-name").addClass("hide"),$(".J-mobile").addClass("hide"),$(".J-province").addClass("hide"),$(".J-city").addClass("hide"),$(".J-area").addClass("hide"),$(".J-address").addClass("hide");var a=$(".send_deliver").val();10==a?$(".express_class").removeClass("hide"):$(".express_class").addClass("hide")}},pickerCity=function(a,b){$.ajax({url:"/System/getCity",type:"post",dataType:"json",data:{province_id:a},success:function(a){1==a.status&&b&&b(a.data)}})},pickerArea=function(a,b){$.ajax({url:"/System/getArea",type:"post",dataType:"json",data:{city_id:a},success:function(a){1==a.status&&b&&b(a.data)}})};